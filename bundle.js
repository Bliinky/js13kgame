"use strict";!function(){var e=function(e,i){return{entities:e,gravity:i,movableEntities:e.filter(function(e){return e.isMovable}),controllableEntities:e.filter(function(e){return e.isControllable})}},i=function(e,i,n,t,r,o,c,l,a,h,u,d,f,s,v){return{x:e,y:i,width:n,height:t,velX:r,velY:o,collisionFactorX:c,collisionFactorY:l,forme:a,color:h,isMovable:u,isControllable:d,isKiller:f,isFinisher:s,childFactory:v,isKilled:!1,canJump:!1}},n={RECT:0,CIRCLE:1,TRIANGLE:2,TRIANGLE_DOWN:3},t=!0,r=function(e,i,t){var r=o(e,t);i.fillStyle=t.color,i.beginPath(),t.forme===n.RECT?i.rect(r.x,r.y,r.width,r.height):t.forme===n.CIRCLE?i.arc(r.x+r.width/2,r.y+r.height/2,r.width/2,0,2*Math.PI):t.forme===n.TRIANGLE?(i.moveTo(r.x+r.width/2,r.y),i.lineTo(r.x+r.width,r.y+r.height),i.lineTo(r.x,r.y+r.height)):t.forme===n.TRIANGLE_DOWN&&(i.moveTo(r.x,r.y),i.lineTo(r.x+r.width,r.y),i.lineTo(r.x+r.width/2,r.y+r.height)),i.closePath(),i.fill()},o=function(e,i){return{x:i.x*e.width/100,y:i.y*e.height/100,width:i.width*e.width/100,height:i.height*e.height/100}},c=function(e,i){var n=e.getContext("2d");n.clearRect(0,0,e.width,e.height),i.forEach(function(i){return r(e,n,i)})},l={init:function(){t=!0},render:function(e){t&&(t=!1,c(a,e.entities.filter(function(e){return!e.isMovable}))),c(h,e.entities.filter(function(e){return e.isMovable}))}},a=document.createElement("canvas");a.width=.8*window.innerWidth,a.height=.8*window.innerHeight,document.getElementsByTagName("body")[0].appendChild(a);var h=document.createElement("canvas");h.width=.8*window.innerWidth,h.height=.8*window.innerHeight,document.getElementsByTagName("body")[0].appendChild(h),window.addEventListener("resize",function(){a.width=.8*window.innerWidth,a.height=.8*window.innerHeight,h.width=.8*window.innerWidth,h.height=.8*window.innerHeight,t=!0},!1);var u=0,d=function(e,i){i||(i=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),t=n.exec(i);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null},f={level:function(){var e=d("map"),i=d("gravity");return s(e&&i?[parseFloat(i),e]:v[u])},next:function(){u<v.length-1?u++:window.alert("win")},previous:function(){u>0&&u--}},s=function(t){var r=t[1].split("|"),o=r.map(function(e){var t=e.split(",");switch(t[0]){case"J":return i(+t[1],+t[2],2,2,0,0,0,0,n.CIRCLE,"red",!0,!0,!1,!1);case"M":return i(+t[1],+t[2],+t[3],+t[4],0,0,0,-.1,n.RECT,"grey",!1,!1,!1,!1);case"T":return i(+t[1],+t[2],+t[3],+t[4],0,0,0,-.5,n.RECT,"blue",!1,!1,!1,!1);case"G":return i(+t[1],+t[2],3,5,0,0,0,0,n.RECT,"violet",!1,!1,!1,!0);case"F":return i(+t[1],+t[2],+t[3],+t[4],0,0,0,0,n.TRIANGLE_DOWN,"orange",!1,!1,!0,!1);case"A":return i(+t[1],+t[2],2,2,0,0,0,0,n.CIRCLE,"pink",!1,!1,!0,!1,function(){return i(50,50,.5,.5,0,0,0,0,n.CIRCLE,"pink",!0,!1,!0,!1)})}});return e(o,t[0])},v=[[1,"J,10,10|T,0,90,90,2|G,90,90|A,50,50"],[1,"J,10,10|T,0,50,80,2|M,50,10,2,40|G,70,45|F,10,0,20,5|F,30,0,10,8|F,40,0,5,3|F,45,0,10,3|F,55,0,10,5"],[1,"J,50,10|T,0,90,95,2|G,90,5|F,55,0,10,10"]],w=function(){},g={update:function(e,i){e.movableEntities.forEach(function(n){n.x+=i*n.velX,n.velX=0,n.y+=i*n.velY,n.velY+=e.gravity})}},y=function(e,i){return!(e.x>=i.x+i.width||e.x+e.width<=i.x||e.y>=i.y+i.height||e.y+e.height<=i.y)},E={check:function(e){var i=!1;return e.entities.forEach(function(n){n.canJump=!1,e.entities.forEach(function(e){n!==e&&y(n,e)&&(n.velX*=e.collisionFactorX,n.velY*=e.collisionFactorY,n.y=e.y-n.height,e.collisionFactorY<0&&(n.canJump=!0),e.isKiller&&(n.isKilled=!0),i=e.isFinisher)})}),i},checkGameOver:function(e){return!!e.controllableEntities.find(function(e){return e.isKilled||e.x>100||e.x<0||e.y>100||e.y<0})}},m=[!1,!1,!1],p=function(e){return function(i){var n=i.keyCode-37;void 0!==m[n]&&(m[n]=e)}};window.addEventListener("keydown",p(!0),!1),window.addEventListener("keyup",p(!1),!1);var x=50,T=-50,C=function(e){e.controllableEntities.forEach(function(e){m[0]?e.velX=-x:m[2]&&(e.velX=x),m[1]&&e.canJump&&(e.velY+=T)})},F=60,R=requestAnimationFrame||function(e){setTimeout(e,1/F*1e3)},b=0,L=function(e,i,n){var t=0,r=function r(){b++;var o=Date.now(),c=(o-t)/1e3;if(C(e),g.update(e,c),E.checkGameOver(e)&&t>0)return n();var a=E.check(e);return a?i():(b%25===0&&e.entities.filter(function(e){return void 0!==e.childFactory}).forEach(function(i){var n=i.childFactory();e.entities.push(n),e.movableEntities.push(n)}),l.render(e),t=o,void R(r))};l.init(),r()},I=function(){f.next(),N()},G=function(){f.previous(),N()},N=function(){var e=f.level();w(e),L(e,I,G)};N()}();