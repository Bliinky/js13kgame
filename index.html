<!DOCTYPE html>
<html>
<head>
<title>js13kgame</title>
<meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport">
<meta charset="utf-8"></head>
<style>body,html{display:block;height:100%;overflow:hidden;background-color:#222}canvas{border:1px solid #444;position:absolute;top:10%;left:10%;margin:0;padding:0;box-sizing:border-box}</style>
<body></body>
<script>
"use strict";!function(){var e=function(e,t){return{entities:e,gravity:t,movableEntities:e.filter(function(e){return e.isMovable}),controllableEntities:e.filter(function(e){return e.isControllable})}},t=function(e,t,i,n,r,o,a,l,c,u,h,s,d,f){return{x:e,y:t,width:i,height:n,velX:r,velY:o,collisionFactorX:a,collisionFactorY:l,forme:c,color:u,isMovable:h,isControllable:s,isKiller:d,isFinisher:f,isKilled:!1,canJump:!1}},i=0,n=1,r=2,o=function(e,t,o){var l=a(e,o);t.fillStyle=o.color,t.beginPath(),o.forme===i?t.rect(l.x,l.y,l.width,l.height):o.forme===n?t.arc(l.x+l.width/2,l.y+l.height/2,l.width/2,0,2*Math.PI):o.forme===r&&(t.moveTo(l.x+l.width/2,l.y),t.lineTo(l.x+l.width,l.y+l.height),t.lineTo(l.x,l.y+l.height)),t.closePath(),t.fill()},a=function(e,t){return{x:t.x*e.width/100,y:t.y*e.height/100,width:t.width*e.width/100,height:t.height*e.height/100}},l=function(e,t){var i=e.getContext("2d");i.clearRect(0,0,e.width,e.height),t.forEach(function(t){return o(e,i,t)})},c={init:function(e){l(h,e.entities.filter(function(e){return e.isMovable})),l(u,e.entities.filter(function(e){return!e.isMovable}))},render:function(e){l(h,e.entities.filter(function(e){return e.isMovable}))}},u=document.createElement("canvas");u.width=.8*window.innerWidth,u.height=.8*window.innerHeight,document.getElementsByTagName("body")[0].appendChild(u);var h=document.createElement("canvas");h.width=.8*window.innerWidth,h.height=.8*window.innerHeight,document.getElementsByTagName("body")[0].appendChild(h),window.addEventListener("resize",function(){u.width=.8*window.innerWidth,u.height=.8*window.innerHeight,h.width=.8*window.innerWidth,h.height=.8*window.innerHeight,Renderer.init(level,h,u)},!1);var s=0,d={level:function(){return f(v[s])},next:function(){s<v.length-1?s++:window.alert("win")},previous:function(){s>0&&s--}},f=function(o){var a=o[1].split("/"),l=a.map(function(e){var o=e.split(",");switch(o[0]){case"J":return t(parseFloat(o[1]),parseFloat(o[2]),2,2,0,0,0,0,n,"red",!0,!0,!1,!1);case"M":return t(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]),parseFloat(o[4]),0,0,0,0,r,"grey",!1,!1,!0,!1);case"T":return t(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]),parseFloat(o[4]),0,0,0,-.5,i,"blue",!1,!1,!1,!1);case"G":return t(parseFloat(o[1]),parseFloat(o[2]),3,5,0,0,0,0,i,"violet",!1,!1,!1,!0)}});return e(l,o[0])},v=[[.05,"J,10,10/T,0,50,80,2/M,50,10,2,40/G,70,45"],[.05,"J,50,10/T,0,90,95,2/G,90,5"]],w=function(e){},g={update:function(e){e.movableEntities.forEach(function(t){t.x+=t.velX,t.velX=0,t.y+=t.velY,t.velY+=e.gravity})}},p=function(e,t){return!(e.x>=t.x+t.width||e.x+e.width<=t.x||e.y>=t.y+t.height||e.y+e.height<=t.y)},y={check:function(e){var t=!1;return e.entities.forEach(function(i){i.canJump=!1,e.entities.forEach(function(e){i!==e&&p(i,e)&&(i.velX*=e.collisionFactorX,i.velY*=e.collisionFactorY,i.y=e.y-i.height,e.collisionFactorY<0&&(i.canJump=!0),e.isKiller&&(i.isKilled=!0),e.isFinisher&&(t=!0))})}),t},checkGameOver:function(e){return!!e.controllableEntities.find(function(e){return e.x>100||e.x<0||e.y>100||e.y<0})}},m=[!1,!1,!1],F=function(e){return function(t){var i=t.keyCode-37;void 0!==m[i]&&(m[i]=e)}};window.addEventListener("keydown",F(!0),!1),window.addEventListener("keyup",F(!1),!1);var x=1,E=-2,b=function(e){e.controllableEntities.forEach(function(e){m[0]?e.velX=-x:m[2]&&(e.velX=x),m[1]&&e.canJump&&(e.velY+=E)})},T=60,M=requestAnimationFrame||function(e){setTimeout(e,1/T*1e3)},X=function(e,t,i){var n=void 0,r=function r(){if(y.checkGameOver(e))return i();var o=Date.now(),a=(o-n)/1e3;b(e),g.update(e,a);var l=y.check(e);return l?t():(c.render(e),n=o,void M(r))};c.init(e),r()},Y=function(){d.next(),J()},k=function(){d.previous(),J()},J=function(){var e=d.level();w(e),X(e,Y,k)};J()}();
</script>
</html>
