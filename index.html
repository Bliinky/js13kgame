<!DOCTYPE html><html><head><title>js13kgame</title><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta charset="utf-8"></head><style>body,html{display:block;height:100%;overflow:hidden;background-color:#222}canvas{border:1px solid #444;position:absolute;top:10%;left:10%;margin:0;padding:0;box-sizing:border-box}</style><body></body><script>"use strict";!function(){var e=function(e,n){return{entities:e,gravity:n,movableEntities:e.filter(function(e){return e.isMovable}),controllableEntities:e.filter(function(e){return e.isControllable})}},n=function(e,n,i,t,r,o,c,l,a,h,u,d,f,s){return{x:e,y:n,width:i,height:t,velX:r,velY:o,collisionFactorX:c,collisionFactorY:l,forme:a,color:h,isMovable:u,isControllable:d,isKiller:f,isFinisher:s,isKilled:!1,canJump:!1}},i={RECT:0,CIRCLE:1,TRIANGLE:2,TRIANGLE_DOWN:3},t=!0,r=function(e,n,t){var r=o(e,t);n.fillStyle=t.color,n.beginPath(),t.forme===i.RECT?n.rect(r.x,r.y,r.width,r.height):t.forme===i.CIRCLE?n.arc(r.x+r.width/2,r.y+r.height/2,r.width/2,0,2*Math.PI):t.forme===i.TRIANGLE?(n.moveTo(r.x+r.width/2,r.y),n.lineTo(r.x+r.width,r.y+r.height),n.lineTo(r.x,r.y+r.height)):t.forme===i.TRIANGLE_DOWN&&(n.moveTo(r.x,r.y),n.lineTo(r.x+r.width,r.y),n.lineTo(r.x+r.width/2,r.y+r.height)),n.closePath(),n.fill()},o=function(e,n){return{x:n.x*e.width/100,y:n.y*e.height/100,width:n.width*e.width/100,height:n.height*e.height/100}},c=function(e,n){var i=e.getContext("2d");i.clearRect(0,0,e.width,e.height),n.forEach(function(n){return r(e,i,n)})},l={init:function(){t=!0},render:function(e){t&&(t=!1,c(a,e.entities.filter(function(e){return!e.isMovable}))),c(h,e.entities.filter(function(e){return e.isMovable}))}},a=document.createElement("canvas");a.width=.8*window.innerWidth,a.height=.8*window.innerHeight,document.getElementsByTagName("body")[0].appendChild(a);var h=document.createElement("canvas");h.width=.8*window.innerWidth,h.height=.8*window.innerHeight,document.getElementsByTagName("body")[0].appendChild(h),window.addEventListener("resize",function(){a.width=.8*window.innerWidth,a.height=.8*window.innerHeight,h.width=.8*window.innerWidth,h.height=.8*window.innerHeight,t=!0},!1);var u=0,d=function(e,n){n||(n=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),t=i.exec(n);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null},f={level:function(){var e=d("map"),n=d("gravity");return s(e&&n?[parseFloat(n),e]:v[u])},next:function(){u<v.length-1?u++:window.alert("win")},previous:function(){u>0&&u--}},s=function(t){var r=t[1].split("|"),o=r.map(function(e){var t=e.split(",");switch(t[0]){case"J":return n(+t[1],+t[2],2,2,0,0,0,0,i.CIRCLE,"red",!0,!0,!1,!1);case"M":return n(+t[1],+t[2],+t[3],+t[4],0,0,0,0,i.RECT,"grey",!1,!1,!1,!1);case"T":return n(+t[1],+t[2],+t[3],+t[4],0,0,0,-.5,i.RECT,"blue",!1,!1,!1,!1);case"G":return n(+t[1],+t[2],3,5,0,0,0,0,i.RECT,"violet",!1,!1,!1,!0);case"F":return n(+t[1],+t[2],+t[3],+t[4],0,0,0,0,i.TRIANGLE_DOWN,"orange",!1,!1,!0,!1)}});return e(o,t[0])},v=[[1,"J,10,10|T,0,90,90,2|F,50,50,10,10|G,90,90"],[1,"J,10,10|T,0,50,80,2|M,50,10,2,40|G,70,45|F,10,0,20,5|F,30,0,10,8|F,40,0,5,3|F,45,0,10,3|F,55,0,10,5"],[1,"J,50,10|T,0,90,95,2|G,90,5|F,55,0,10,10"]],w=function(){},g={update:function(e,n){e.movableEntities.forEach(function(i){i.x+=n*i.velX,i.velX=0,i.y+=n*i.velY,i.velY+=e.gravity})}},y=function(e,n){return!(e.x>=n.x+n.width||e.x+e.width<=n.x||e.y>=n.y+n.height||e.y+e.height<=n.y)},m={check:function(e){var n=!1;return e.entities.forEach(function(i){i.canJump=!1,e.entities.forEach(function(e){i!==e&&y(i,e)&&(i.velX*=e.collisionFactorX,i.velY*=e.collisionFactorY,i.y=e.y-i.height,e.collisionFactorY<0&&(i.canJump=!0),e.isKiller&&(i.isKilled=!0),n=e.isFinisher)})}),n},checkGameOver:function(e){return!!e.controllableEntities.find(function(e){return e.isKilled||e.x>100||e.x<0||e.y>100||e.y<0})}},E=[!1,!1,!1],x=function(e){return function(n){var i=n.keyCode-37;void 0!==E[i]&&(E[i]=e)}};window.addEventListener("keydown",x(!0),!1),window.addEventListener("keyup",x(!1),!1);var T=50,p=-50,C=function(e){e.controllableEntities.forEach(function(e){E[0]?e.velX=-T:E[2]&&(e.velX=T),E[1]&&e.canJump&&(e.velY+=p)})},F=60,R=requestAnimationFrame||function(e){setTimeout(e,1/F*1e3)},b=function(e,n,i){var t=0,r=function r(){var o=Date.now(),c=(o-t)/1e3;if(C(e),g.update(e,c),m.checkGameOver(e)&&t>0)return i();var a=m.check(e);return a?n():(l.render(e),t=o,void R(r))};l.init(),r()},G=function(){f.next(),I()},L=function(){f.previous(),I()},I=function(){var e=f.level();w(e),b(e,G,L)};I()}();</script></html>